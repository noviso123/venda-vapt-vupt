{% extends "base.html" %}

{% block content %}
<div class="max-w-xl mx-auto px-4">
    <div class="text-center mb-10">
        <h2 class="text-3xl font-black text-slate-800 mb-2">Criar Sua Conta</h2>
        <p class="text-slate-500">Cadastre-se para acompanhar seus pedidos em tempo real.</p>
    </div>

    <form action="/cadastro" method="POST" class="space-y-6">
        <div class="glass p-6 md:p-8 rounded-3xl space-y-6">
            <!-- Dados Básicos -->
            <div>
                <label class="block text-sm font-bold mb-2">Nome Completo</label>
                <input type="text" name="name" required placeholder="João Silva"
                    class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:border-primary">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-bold mb-2">E-mail</label>
                    <input type="email" name="email" required placeholder="seu@email.com"
                        class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:border-primary">
                </div>
                <div>
                    <label class="block text-sm font-bold mb-2">WhatsApp</label>
                    <input type="text" name="whatsapp" required placeholder="5511999999999"
                        class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:border-primary">
                </div>
            </div>

            <div>
                <label class="block text-sm font-bold mb-2">Sua Senha</label>
                <input type="password" name="password" required placeholder="••••••••"
                    class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:border-primary">
            </div>

            <hr class="border-slate-100 my-4">

            <!-- Endereço -->
            <h3 class="font-bold text-slate-700 flex items-center gap-2 mb-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-primary" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                </svg>
                Endereço de Entrega
            </h3>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="md:col-span-1">
                    <label class="block text-sm font-bold mb-2">CEP</label>
                    <input type="text" name="cep" id="cep" required placeholder="00000-000" maxlength="9"
                        inputmode="numeric"
                        class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:border-primary font-mono">
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-bold mb-2">Rua</label>
                    <input type="text" name="street" id="street" required placeholder="Preenchimento automático"
                        class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:border-primary">
                </div>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                <div class="col-span-1">
                    <label class="block text-sm font-bold mb-2">Número</label>
                    <input type="text" name="number" id="number" required
                        class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:border-primary">
                </div>
                <div class="col-span-1 md:col-span-2">
                    <label class="block text-sm font-bold mb-2">Complemento</label>
                    <input type="text" name="complement" placeholder="Apt, Bloco..."
                        class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:border-primary">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-bold mb-2">Bairro</label>
                    <input type="text" name="neighborhood" id="neighborhood" required
                        class="w-full px-4 py-3 rounded-xl border border-slate-200 outline-none focus:border-primary">
                </div>
                <div>
                    <label class="block text-sm font-bold mb-2">Cidade/UF</label>
                    <div class="flex gap-2">
                        <input type="text" name="city" id="city" required
                            class="flex-1 px-4 py-3 rounded-xl border border-slate-200 outline-none focus:border-primary">
                        <input type="text" name="state" id="state" required maxlength="2"
                            class="w-16 px-4 py-3 rounded-xl border border-slate-200 outline-none focus:border-primary uppercase text-center font-bold">
                    </div>
                </div>
            </div>
        </div>

        <button type="submit"
            class="w-full py-5 bg-primary text-white rounded-2xl font-black text-xl shadow-xl shadow-blue-100 hover:scale-[1.02] active:scale-95 transition-all">
            CRIAR MINHA CONTA
        </button>

        <div class="text-center pt-2">
            <p class="text-slate-500">Já tem uma conta? <a href="/login"
                    class="text-primary font-bold hover:underline transition-all">Faça Login</a>
            </p>
        </div>
    </form>
</div>

<script>
    function lookupCep ( cep )
    {
        cep = cep.replace( /\D/g, '' );
        if ( cep.length === 8 )
        {
            const streetInput = document.getElementById( 'street' );
            const neighborhoodInput = document.getElementById( 'neighborhood' );
            const cityInput = document.getElementById( 'city' );
            const stateInput = document.getElementById( 'state' );
            const numberInput = document.getElementById( 'number' );

            const originalPlaceholder = streetInput.placeholder;
            streetInput.placeholder = 'Buscando...';

            fetch( `https://viacep.com.br/ws/${ cep }/json/` )
                .then( response => response.json() )
                .then( data =>
                {
                    streetInput.placeholder = originalPlaceholder;
                    if ( !data.erro )
                    {
                        streetInput.value = data.logradouro;
                        neighborhoodInput.value = data.bairro;
                        cityInput.value = data.localidade;
                        stateInput.value = data.uf;
                        numberInput.focus();
                    } else
                    {
                        alert( 'CEP não encontrado.' );
                    }
                } )
                .catch( () =>
                {
                    streetInput.placeholder = originalPlaceholder;
                    alert( 'Erro ao buscar CEP.' );
                } );
        }
    }

    // GatilhoAutomático e Máscara CEP
    document.getElementById( 'cep' ).addEventListener( 'input', function ( e )
    {
        var raw = e.target.value.replace( /\D/g, '' );
        var x = raw.match( /(\d{0,5})(\d{0,3})/ );
        e.target.value = !x[ 2 ] ? x[ 1 ] : x[ 1 ] + '-' + x[ 2 ];

        // Disparar busca ao atingir 8 dígitos
        if ( raw.length === 8 )
        {
            lookupCep( raw );
        }
    } );
</script>
{% endblock %}

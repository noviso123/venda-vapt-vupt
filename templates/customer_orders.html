{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="flex items-center justify-between mb-10">
        <div>
            <h2 class="text-3xl font-black text-slate-800">Meus Pedidos</h2>
            <p class="text-slate-500 text-sm">Olá, {{ session.customer_name }}! Acompanhe suas compras aqui.</p>
        </div>
        <a href="/logout"
            class="px-6 py-2 bg-slate-100 text-slate-600 rounded-xl font-bold hover:bg-red-50 hover:text-red-600 transition-all text-sm">
            Sair da Conta
        </a>
    </div>

    {% if orders %}
    <div class="space-y-6">
        {% for order in orders %}
        <div
            class="glass p-8 rounded-3xl shadow-xl shadow-slate-100/50 border border-slate-100 transition-all hover:border-primary/30">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
                <div>
                    <span class="text-[10px] font-black uppercase text-slate-400 tracking-widest block mb-1">Pedido
                        #{{ order.id[:8] }}</span>
                    <h3 class="text-xl font-black text-slate-800">Total: <span class="text-primary">R$
                            {{ "%.2f"|format(order.total) }}</span></h3>
                    <p class="text-slate-400 text-xs mt-1">Realizado em: {{ order.created_at[:10] }}</p>
                </div>

                <div class="flex items-center gap-2">
                    <a href="https://wa.me/{{ order.stores.whatsapp }}?text=Olá! Gostaria de informações sobre o pedido #{{ order.id[:8] }}"
                        class="px-4 py-2 bg-sky-50 text-sky-600 rounded-xl font-bold text-sm flex items-center gap-2 hover:bg-sky-100 transition-all">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="currentColor" viewBox="0 0 24 24">
                            <path
                                d="M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.588-5.946 0-6.556 5.332-11.891 11.891-11.891 3.179 0 6.164 1.24 8.407 3.483 2.243 2.243 3.483 5.228 3.483 8.407 0 6.556-5.334 11.892-11.892 11.892-2.003 0-3.966-.505-5.698-1.467l-6.29 1.685zm6.204-14.735c0 0 0 .001 0 0-.131-.295-.262-.303-.384-.308-.113-.005-.245-.005-.376-.005-.132 0-.346.049-.527.247-.181.197-.691.674-.691 1.643s.704 1.907.803 2.039c.099.132 1.385 2.113 3.354 2.964.468.203.833.324 1.116.414.471.15.9.128 1.24.077.378-.057 1.164-.476 1.328-.936.164-.459.164-.853.114-.936-.049-.082-.181-.132-.378-.231s-1.164-.574-1.344-.64c-.181-.065-.312-.099-.444.099-.131.197-.509.64-.624.772-.115.132-.23.148-.427.049-.197-.099-.831-.307-1.583-.978-.585-.522-.981-1.166-1.096-1.363-.115-.197-.012-.303.087-.402.089-.089.197-.231.295-.346.099-.115.132-.197.197-.329.066-.131.033-.247-.017-.346z" />
                        </svg>
                        Suporte Vendedor
                    </a>
                </div>
            </div>

            <!-- TIMELINE DE STATUS -->
            <div class="relative pt-8 pb-4">
                <div class="absolute top-8 left-0 w-full h-1 bg-slate-100 rounded-full"></div>
                {% set status_map = {'pending_payment': 1, 'paid': 2, 'shipped': 3, 'delivered': 4} %}
                {% set current_step = status_map.get(order.status, 1) %}

                <div class="absolute top-8 left-0 h-1 bg-primary rounded-full transition-all duration-500"
                    style="width: {{ ((current_step - 1) / 3 * 100) }}%;"></div>

                <div class="relative flex justify-between">
                    <!-- Step 1: Recebido -->
                    <div class="flex flex-col items-center">
                        <div
                            class="w-4 h-4 rounded-full border-4 {{ 'bg-primary border-blue-100 animate-pulse' if current_step == 1 else ('bg-primary border-blue-50' if current_step > 1 else 'bg-slate-200 border-white') }} relative z-10">
                        </div>
                        <span
                            class="text-[10px] font-bold mt-2 {{ 'text-primary' if current_step >= 1 else 'text-slate-400' }}">RECEBIDO</span>
                    </div>

                    <!-- Step 2: Pago -->
                    <div class="flex flex-col items-center">
                        <div
                            class="w-4 h-4 rounded-full border-4 {{ 'bg-primary border-blue-100 animate-pulse' if current_step == 2 else ('bg-primary border-blue-50' if current_step > 2 else 'bg-slate-200 border-white') }} relative z-10">
                        </div>
                        <span
                            class="text-[10px] font-bold mt-2 {{ 'text-primary' if current_step >= 2 else 'text-slate-400' }}">PREPARANDO</span>
                    </div>

                    <!-- Step 3: Enviado -->
                    <div class="flex flex-col items-center">
                        <div
                            class="w-4 h-4 rounded-full border-4 {{ 'bg-primary border-blue-100 animate-pulse' if current_step == 3 else ('bg-primary border-blue-50' if current_step > 3 else 'bg-slate-200 border-white') }} relative z-10">
                        </div>
                        <span
                            class="text-[10px] font-bold mt-2 {{ 'text-primary' if current_step >= 3 else 'text-slate-400' }}">EM
                            TRÂNSITO</span>
                    </div>

                    <!-- Step 4: Entregue -->
                    <div class="flex flex-col items-center">
                        <div
                            class="w-4 h-4 rounded-full border-4 {{ 'bg-primary border-blue-100 animate-pulse' if current_step == 4 else ('bg-primary border-blue-50' if current_step > 4 else 'bg-slate-200 border-white') }} relative z-10">
                        </div>
                        <span
                            class="text-[10px] font-bold mt-2 {{ 'text-primary' if current_step >= 4 else 'text-slate-400' }}">ENTREGUE</span>
                    </div>
                </div>
            </div>

            <div class="mt-8 p-4 bg-slate-50/50 rounded-2xl border border-slate-100/50">
                <p class="text-[11px] font-bold text-slate-400 uppercase mb-2">Informações de Entrega</p>
                <p class="text-sm text-slate-600 leading-relaxed">{{ order.delivery_address }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="glass py-20 text-center rounded-3xl border border-dashed border-slate-200">
        <div class="w-20 h-20 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-6">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-slate-300" fill="none" viewBox="0 0 24 24"
                stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
            </svg>
        </div>
        <h3 class="text-xl font-bold text-slate-400 mb-2">Você ainda não tem pedidos</h3>
        <p class="text-slate-400 mb-8">O que tal começar a comprar agora?</p>
        <a href="/"
            class="px-8 py-4 bg-primary text-white rounded-2xl font-black shadow-lg shadow-blue-100 hover:scale-105 transition-all inline-block">
            VER PRODUTOS
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

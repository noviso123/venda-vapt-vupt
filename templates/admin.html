{% extends "base.html" %}

{% block content %}
<div class="flex items-center gap-4">
    <h1 class="text-4xl font-black text-slate-800">Painel Administrativo</h1>
    <a href="/logout"
        class="text-xs font-bold text-red-400 hover:text-red-600 transition-all uppercase tracking-widest">Sair</a>
</div>
<p class="text-slate-500">Gestão da loja: <span
        class="font-bold text-primary">{{ store.name if store else 'Configuração Pendente' }}</span></p>

<!-- ABAS -->
<div class="flex gap-8 border-b border-slate-200 mb-8 mt-8">
    <button onclick="switchTab('orders')" id="tab-orders"
        class="pb-4 px-2 font-bold text-primary border-b-2 border-primary transition-all">Pedidos</button>
    <button onclick="switchTab('products')" id="tab-products"
        class="pb-4 px-2 font-bold text-slate-400 border-b-2 border-transparent transition-all">Produtos
        (Estoque)</button>
    <button onclick="switchTab('settings')" id="tab-settings"
        class="pb-4 px-2 font-bold text-slate-400 border-b-2 border-transparent transition-all">Configurações</button>
</div>

<!-- SEÇÃO DE PEDIDOS -->
<div id="section-orders" class="space-y-4">
    {% for order in orders %}
    <div class="glass p-6 rounded-3xl flex items-center justify-between">
        <div>
            <div class="flex items-center gap-2 mb-1">
                <span class="text-xs font-black uppercase text-slate-400">#{{ order.id[:8] }}</span>
                <span
                    class="bg-blue-100 text-blue-600 text-[10px] font-black px-2 py-0.5 rounded-full uppercase">{{ order.status }}</span>
            </div>
            <h3 class="font-bold text-slate-800">{{ order.customers.name }}</h3>
            <p class="text-xs text-slate-500">{{ order.delivery_address }}</p>
        </div>
        <div class="text-right">
            <p class="text-xl font-black text-primary mb-2">R$ {{ "%.2f"|format(order.total) }}</p>
            <form action="/vendedor/pedido/{{ order.id }}/status" method="POST" class="flex gap-2">
                <select name="status" class="text-xs border border-slate-200 rounded-lg px-2 py-1 outline-none">
                    <option value="pending_payment" {% if order.status == 'pending_payment' %}selected{% endif %}>
                        Pendente</option>
                    <option value="paid" {% if order.status == 'paid' %}selected{% endif %}>Pago</option>
                    <option value="shipped" {% if order.status == 'shipped' %}selected{% endif %}>Enviado</option>
                    <option value="delivered" {% if order.status == 'delivered' %}selected{% endif %}>Entregue</option>
                </select>
                <button type="submit"
                    class="bg-slate-800 text-white text-[10px] font-bold px-3 py-1 rounded-lg">OK</button>
            </form>
        </div>
    </div>
    {% else %}
    <div class="py-20 text-center text-slate-400">Nenhum pedido recebido ainda.</div>
    {% endfor %}
</div>

<!-- SEÇÃO DE PRODUTOS -->
<div id="section-products" class="hidden space-y-6">
    <div class="glass p-8 rounded-3xl">
        <h3 class="text-xl font-bold mb-6">Cadastrar Novo Produto</h3>
        <form action="/vendedor/produto/novo" method="POST" enctype="multipart/form-data"
            class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-bold mb-2">Nome do Produto</label>
                    <input type="text" name="name" required class="w-full px-4 py-3 rounded-xl border border-slate-200">
                </div>
                <div>
                    <label class="block text-sm font-bold mb-2">Descrição</label>
                    <textarea name="description"
                        class="w-full px-4 py-3 rounded-xl border border-slate-200 h-24"></textarea>
                </div>
            </div>
            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-bold mb-2">Preço (R$)</label>
                        <input type="number" step="0.01" name="price" required
                            class="w-full px-4 py-3 rounded-xl border border-slate-200">
                    </div>
                    <div>
                        <label class="block text-sm font-bold mb-2 text-blue-600">Estoque Inicial</label>
                        <input type="number" name="stock_quantity" value="99" required
                            class="w-full px-4 py-3 rounded-xl border border-blue-200">
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-bold mb-2">Foto do Produto</label>
                    <input type="file" name="file" accept="image/*"
                        class="w-full px-4 py-3 rounded-xl border border-slate-200 bg-white">
                </div>
                <button type="submit"
                    class="w-full py-4 btn-primary text-white rounded-2xl font-bold shadow-lg shadow-blue-200 mt-2">Adicionar
                    Produto</button>
            </div>
        </form>
    </div>

    <!-- LISTA DE PRODUTOS E ESTOQUE -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        {% for product in products %}
        <div class="glass p-4 rounded-2xl flex items-center gap-4">
            <div class="w-16 h-16 rounded-xl bg-slate-100 overflow-hidden shrink-0">
                {% if product.image_url %}
                <img src="{{ product.image_url }}" class="w-full h-full object-cover">
                {% endif %}
            </div>
            <div class="flex-1">
                <h4 class="font-bold text-slate-800">{{ product.name }}</h4>
                <p class="text-xs text-slate-500">R$ {{ "%.2f"|format(product.price) }}</p>
            </div>
            <div class="text-right">
                <span class="text-[10px] font-black uppercase text-slate-400 block mb-1">Stock</span>
                <span
                    class="{% if product.stock_quantity < 5 %}text-red-500{% else %}text-emerald-500{% endif %} font-black text-xl">
                    {{ product.stock_quantity }}
                </span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- SEÇÃO DE CONFIGURAÇÕES -->
<div id="section-settings" class="hidden">
    <div class="glass p-8 rounded-3xl max-w-2xl mx-auto">
        <h3 class="text-xl font-bold mb-6">Configurações da Loja</h3>
        <form action="/vendedor/configuracoes" method="POST" enctype="multipart/form-data" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-bold mb-2">Nome da Loja</label>
                    <input type="text" name="name" value="{{ store.name if store else '' }}"
                        class="w-full px-4 py-3 rounded-xl border border-slate-200">
                </div>
                <div>
                    <label class="block text-sm font-bold mb-2">WhatsApp (Com DDD)</label>
                    <input type="text" name="whatsapp" value="{{ store.whatsapp if store else '' }}"
                        class="w-full px-4 py-3 rounded-xl border border-slate-200">
                </div>
            </div>

            <div>
                <label class="block text-sm font-bold mb-2 text-primary">Mensagem Inteligente WhatsApp (Links)</label>
                <textarea name="whatsapp_message" rows="3"
                    class="w-full px-4 py-3 rounded-xl border border-primary/20 outline-none">{{ store.whatsapp_message if store else 'Olá! Quero comprar estes itens: ' }}</textarea>
                <p class="text-[10px] text-slate-400 mt-1">O sistema adicionará a lista de produtos e o valor total ao
                    final desta mensagem.</p>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-bold mb-2">Cor Primária</label>
                    <input type="color" name="primary_color" value="{{ store.primary_color if store else '#3B82F6' }}"
                        class="w-full h-12 rounded-xl border border-slate-200 cursor-pointer">
                </div>
                <div>
                    <label class="block text-sm font-bold mb-2">Cor Secundária</label>
                    <input type="color" name="secondary_color"
                        value="{{ store.secondary_color if store else '#10B981' }}"
                        class="w-full h-12 rounded-xl border border-slate-200 cursor-pointer">
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 border-t border-slate-100 pt-6">
                <div>
                    <label class="block text-sm font-bold mb-2 text-primary">Usuário Admin</label>
                    <input type="text" name="admin_user" value="{{ store.admin_user if store else 'admin' }}"
                        class="w-full px-4 py-3 rounded-xl border border-primary/20 bg-primary/5">
                </div>
                <div>
                    <label class="block text-sm font-bold mb-2 text-primary">Senha Admin</label>
                    <input type="text" name="admin_password"
                        value="{{ store.admin_password if store else 'vaptvupt123' }}"
                        class="w-full px-4 py-3 rounded-xl border border-primary/20 bg-primary/5">
                </div>
            </div>

            <button type="submit"
                class="w-full py-4 btn-primary text-white rounded-2xl font-bold shadow-lg shadow-blue-200 mt-4">Salvar
                Configurações</button>
        </form>
    </div>
</div>

<script>
    function switchTab ( tab )
    {
        document.querySelectorAll( '[id^="section-"]' ).forEach( s => s.classList.add( 'hidden' ) );
        document.querySelectorAll( '[id^="tab-"]' ).forEach( t =>
        {
            t.classList.remove( 'text-primary', 'border-primary' );
            t.classList.add( 'text-slate-400', 'border-transparent' );
        } );

        document.getElementById( `section-${ tab }` ).classList.remove( 'hidden' );
        document.getElementById( `tab-${ tab }` ).classList.add( 'text-primary', 'border-primary' );
        document.getElementById( `tab-${ tab }` ).classList.remove( 'text-slate-400', 'border-transparent' );
    }
</script>
{% endblock %}
